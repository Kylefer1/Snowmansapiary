<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Snowmanâ€™s Apiary</title>

<style>
:root{
  --bg1:#0a1320;
  --card:rgba(255,255,255,.06);
  --stroke:rgba(255,255,255,.12);
  --text:#f3f6ff;
  --muted:rgba(243,246,255,.82);
  --shadow:0 18px 55px rgba(0,0,0,.45);
  --radius:22px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:radial-gradient(1200px 900px at 20% 15%,#1a2f53 0%,var(--bg1) 45%,#050a12 100%);
  color:var(--text);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  padding:24px 12px;
}

/* Shake */
.shake{animation:shake .18s infinite linear}
@keyframes shake{
  0%{transform:translate(0,0)}
  25%{transform:translate(1px,-1px)}
  50%{transform:translate(-1px,1px)}
  75%{transform:translate(1px,1px)}
  100%{transform:translate(0,0)}
}

/* Card */
.card{
  width:min(720px,92vw);
  background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.04));
  border:1px solid var(--stroke);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:18px;
  text-align:center;
  backdrop-filter:blur(10px);
  position:relative;
  z-index:6;
}
.card img{
  width:100%;
  max-width:520px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.1);
  margin-bottom:12px;
}
h1{margin:6px 0;font-size:clamp(32px,6vw,52px)}
.sub{color:var(--muted)}
.status{opacity:.75;margin-bottom:12px}
a.btn{
  display:inline-block;
  padding:12px 18px;
  border-radius:14px;
  background:rgba(255,255,255,.1);
  color:white;
  text-decoration:none;
  font-weight:800;
  border:1px solid rgba(255,255,255,.18);
}

/* HUD */
.hud{
  position:fixed;
  top:10px;
  left:10px;
  background:rgba(0,0,0,.25);
  border:1px solid rgba(255,255,255,.12);
  border-radius:14px;
  padding:8px 10px;
  font-size:12px;
  z-index:10;
  backdrop-filter:blur(10px);
  pointer-events:none;
}
.hud .row{display:flex;justify-content:space-between}
.bar{
  margin-top:6px;
  height:8px;
  background:rgba(255,255,255,.2);
  border-radius:999px;
  overflow:hidden;
}
.barFill{height:100%;width:0%;background:white}

/* Canvases */
#snow,#pile{
  position:fixed;
  left:0;
  width:100%;
}
#snow{
  top:0;
  height:100%;
  z-index:2;
  pointer-events:none;
}
#pile{
  bottom:0;
  height:28vh;
  z-index:4;
  pointer-events:auto;
}

/* Poof */
.poof{
  position:fixed;
  font-weight:900;
  color:white;
  pointer-events:none;
  animation:poof .6s ease-out forwards;
  transform:translate(-50%,-50%);
}
@keyframes poof{
  from{opacity:1;transform:translate(-50%,-50%) scale(.8)}
  to{opacity:0;transform:translate(-50%,-100%) scale(1.2)}
}

/* Overlay */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  backdrop-filter:blur(8px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20;
}
.panel{
  background:rgba(15,25,40,.9);
  border-radius:18px;
  padding:18px;
  border:1px solid rgba(255,255,255,.2);
  text-align:center;
}
.panel button{
  margin-top:10px;
  padding:10px 14px;
  border-radius:14px;
  background:rgba(255,255,255,.15);
  border:1px solid rgba(255,255,255,.2);
  color:white;
  font-weight:800;
}
</style>
</head>

<body>
<canvas id="snow"></canvas>
<canvas id="pile"></canvas>

<div class="hud">
  <div class="row"><span>Score</span><span id="score">0</span></div>
  <div class="row"><span>Combo</span><span id="combo">x0</span></div>
  <div class="row"><span>Blizzard</span><span id="blz">idle</span></div>
  <div class="bar"><div class="barFill" id="barFill"></div></div>
</div>

<div class="card">
  <img src="logo.png" alt="Snowmanâ€™s Apiary logo">
  <h1>Snowmanâ€™s Apiary</h1>
  <div class="sub">Local honey & apiary goods.</div>
  <div class="status">Currently out of stock â€” expecting more honey by summer.</div>
  <a class="btn" href="mailto:snowmansapiary@yahoo.com">Email Snowmanâ€™s Apiary</a>
</div>

<div class="overlay" id="overlay">
  <div class="panel">
    <h2>ðŸ¥¶ You got buried.</h2>
    <p>The blizzard always wins.</p>
    <button onclick="location.reload()">Try again</button>
  </div>
</div>

<script>
(() => {
const snow=document.getElementById('snow');
const pile=document.getElementById('pile');
const sctx=snow.getContext('2d');
const pctx=pile.getContext('2d');

function resize(){
  snow.width=innerWidth; snow.height=innerHeight;
  pile.width=innerWidth; pile.height=innerHeight*.28;
}
resize(); addEventListener('resize',resize);

// Snowflakes
const flakes=[...Array(160)].map(()=>({
  x:Math.random()*innerWidth,
  y:Math.random()*innerHeight,
  r:1+Math.random()*3,
  s:20+Math.random()*40,
  d:-15+Math.random()*30
}));

let score=0,combo=0;
let pileLevel=.12;
let bar=0;
let alive=true;

let blizzard=false;
let blzTime=0,blzDur=0;

let timeAlive=0;

// ===== DIFFICULTY TUNING =====
const T={
  pileRise:0.020,
  pileBlizzard:8.5,

  shovelStart:0.040,        // starts weak
  shovelDecay:0.0045,       // permanent decay
  shovelMin:0.018,          // never zero
  comboGain:0.007,

  barTap:0.060,
  barLeak:0.050
};

pile.addEventListener('pointerdown',e=>{
  if(!alive) return;

  combo++;
  score+=1+Math.floor(combo*.5);

  bar=Math.min(1,bar+T.barTap);
  if(!blizzard && bar>=1) startBlizzard();

  // GLOBAL fatigue
  let shovelPower=
    T.shovelStart
    - timeAlive*T.shovelDecay
    + combo*T.comboGain;

  shovelPower=Math.max(T.shovelMin,shovelPower);

  // Blizzard penalty (STACKING)
  if(blizzard){
    shovelPower*=0.55;
  }

  pileLevel=Math.max(0,pileLevel-shovelPower);

  poof(e.clientX,e.clientY);
});

function startBlizzard(){
  blizzard=true;
  blzDur=10+Math.random()*8;
  blzTime=blzDur;
}

function poof(x,y){
  const p=document.createElement('div');
  p.className='poof';
  p.textContent=Math.random()<.5?'POOF':'POP';
  p.style.left=x+'px';
  p.style.top=y+'px';
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),600);
}

let last=performance.now();
function loop(){
  const now=performance.now();
  const dt=(now-last)/1000;
  last=now;
  if(alive) timeAlive+=dt;

  // Snow
  sctx.clearRect(0,0,snow.width,snow.height);
  flakes.forEach(f=>{
    f.y+=f.s*(blizzard?4:1)*dt;
    f.x+=f.d*dt;
    if(f.y>innerHeight){f.y=-10;f.x=Math.random()*innerWidth}
    sctx.beginPath();
    sctx.arc(f.x,f.y,f.r,0,Math.PI*2);
    sctx.fillStyle='white';
    sctx.fill();
  });

  // Blizzard logic
  if(blizzard){
    blzTime-=dt;
    document.body.classList.add('shake');
    if(blzTime<=0){
      blizzard=false;
      bar=0;
      document.body.classList.remove('shake');
    }
  }else{
    bar=Math.max(0,bar-T.barLeak*dt);
  }

  // Pile rise
  let rise=T.pileRise*(blizzard?T.pileBlizzard:1);
  pileLevel+=rise*dt;

  if(pileLevel>=.99){
    alive=false;
    document.getElementById('overlay').style.display='flex';
    return;
  }

  // Draw pile
  pctx.clearRect(0,0,pile.width,pile.height);
  const h=pile.height;
  const y=h-(h*pileLevel);
  pctx.beginPath();
  pctx.moveTo(0,h);
  for(let i=0;i<=10;i++){
    const x=(i/10)*pile.width;
    pctx.lineTo(x,y+Math.sin(i+timeAlive*2)*12);
  }
  pctx.lineTo(pile.width,h);
  pctx.fillStyle='rgba(245,247,255,.92)';
  pctx.fill();

  // HUD
  document.getElementById('score').textContent=score;
  document.getElementById('combo').textContent='x'+combo;
  document.getElementById('blz').textContent=blizzard?'ACTIVE':'idle';
  document.getElementById('barFill').style.width=(bar*100)+'%';

  requestAnimationFrame(loop);
}
loop();
})();
</script>
</body>
</html>
